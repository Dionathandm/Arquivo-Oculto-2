<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arquivo Oculto - Jogo Narrativo</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@300;400;600&family=Special+Elite&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #0a0a0a;
            color: #d1d1d1;
            font-family: 'Crimson Pro', serif;
            scroll-behavior: smooth;
        }
        .typewriter {
            font-family: 'Special Elite', cursive;
        }
        .file-border {
            border-left: 2px solid #333;
            padding-left: 1.5rem;
        }
        .chapter-transition {
            transition: opacity 0.5s ease-in-out;
        }
        .hidden-content {
            display: none;
        }
        .locked-overlay {
            background: linear-gradient(to top, #0a0a0a 0%, transparent 100%);
        }
        input::placeholder {
            color: #444;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .animate-shake {
            animation: shake 0.2s ease-in-out 0s 2;
        }
    </style>
</head>
<body class="selection:bg-red-900 selection:text-white">

    <!-- App Container -->
    <div id="app" class="min-h-screen flex flex-col">
        
        <!-- Navigation / Header -->
        <header class="p-6 border-b border-zinc-800 flex justify-between items-center sticky top-0 bg-[#0a0a0a]/90 backdrop-blur-sm z-50">
            <div class="typewriter text-red-700 text-xl font-bold tracking-tighter cursor-pointer" onclick="showView('home')">
                ARQUIVO_OCULTO
            </div>
            <nav id="main-nav" class="hidden">
                <button onclick="showView('cases')" class="text-zinc-500 hover:text-white transition-colors text-sm uppercase tracking-widest">Casos</button>
            </nav>
        </header>

        <!-- Views -->
        <main class="flex-grow container mx-auto px-4 max-w-2xl py-12">
            
            <!-- VIEW: HOME -->
            <section id="view-home" class="view flex flex-col items-center justify-center text-center space-y-8 py-20">
                <div class="space-y-4">
                    <h1 class="text-5xl md:text-7xl font-light tracking-tighter text-zinc-100">Nem todo crime é <span class="italic text-zinc-500">resolvido</span>.</h1>
                    <p class="text-zinc-400 text-lg max-w-md mx-auto">Alguns são apenas esquecidos. Outros, escondidos em prateleiras que ninguém ousa tocar.</p>
                </div>
                <button onclick="showView('cases')" class="group relative px-8 py-3 overflow-hidden border border-zinc-700 hover:border-red-900 transition-all duration-500">
                    <span class="relative z-10 text-zinc-300 group-hover:text-white uppercase tracking-[0.2em] text-sm">Entrar nos Arquivos</span>
                    <div class="absolute inset-0 bg-red-950/20 translate-y-full group-hover:translate-y-0 transition-transform duration-500"></div>
                </button>
            </section>

            <!-- VIEW: CASE LIST -->
            <section id="view-cases" class="view hidden space-y-12">
                <h2 class="typewriter text-2xl text-zinc-400 mb-8">Arquivos Pendentes</h2>
                
                <div onclick="startCase('arquivo-01')" class="group p-6 border border-zinc-800 bg-zinc-900/20 hover:bg-zinc-900/40 cursor-pointer transition-all border-l-4 border-l-zinc-700 hover:border-l-red-800">
                    <div class="flex justify-between items-start mb-4">
                        <span class="text-xs text-zinc-500 typewriter">REF: 01-77-B</span>
                        <span class="text-[10px] bg-zinc-800 px-2 py-1 text-zinc-400 uppercase tracking-tighter">Gratuito</span>
                    </div>
                    <h3 class="text-2xl text-zinc-200 group-hover:text-white transition-colors">O Silêncio do Arquivo 01</h3>
                    <p class="text-zinc-500 mt-2 italic">"O erro não estava no crime. Estava no investigador."</p>
                    <div class="mt-6 flex items-center text-xs text-red-900 font-bold uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity">
                        Abrir Arquivo →
                    </div>
                </div>

                <div id="case-02-locked" class="p-6 border border-zinc-900 bg-zinc-950/20 cursor-not-allowed opacity-40">
                    <div class="flex justify-between items-start mb-4">
                        <span class="text-xs text-zinc-700 typewriter">REF: 02-31-J</span>
                        <span class="text-[10px] bg-zinc-900 px-2 py-1 text-zinc-600 uppercase tracking-tighter">Bloqueado</span>
                    </div>
                    <h3 class="text-2xl text-zinc-700">Quem Matou Júlia?</h3>
                    <p class="text-zinc-700 mt-2">Este caso só pode ser acessado por investigadores que concluíram o Arquivo 01.</p>
                </div>

                <div id="case-02-unlocked" onclick="requireInvestigationAccessOrStart('arquivo-02')" class="hidden group p-6 border border-zinc-800 bg-zinc-900/20 hover:bg-zinc-900/40 cursor-pointer transition-all border-l-4 border-l-zinc-700 hover:border-l-red-800">
                    <div class="flex justify-between items-start mb-4">
                        <span class="text-xs text-zinc-500 typewriter">REF: 02-31-J</span>
                        <span class="text-[10px] bg-zinc-800 px-2 py-1 text-zinc-400 uppercase tracking-tighter">Interativo</span>
                    </div>
                    <h3 class="text-2xl text-zinc-200 group-hover:text-white transition-colors">Quem Matou Júlia?</h3>
                    <p class="text-zinc-500 mt-2 italic">"Desta vez, não sou eu quem vai errar."</p>
                    <div class="mt-6 flex items-center text-xs text-red-900 font-bold uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity">
                        Iniciar Investigação →
                    </div>
                </div>

                <div class="opacity-30 p-6 border border-zinc-900 bg-zinc-950/20 cursor-not-allowed">
                    <div class="flex justify-between items-start mb-4">
                        <span class="text-xs text-zinc-700 typewriter">REF: 03-44-K</span>
                        <span class="text-[10px] bg-zinc-900 px-2 py-1 text-zinc-600 uppercase tracking-tighter">Bloqueado</span>
                    </div>
                    <h3 class="text-2xl text-zinc-700">A Memória de Vidro</h3>
                    <p class="text-zinc-700 mt-2">Próximo caso em breve...</p>
                </div>
            </section>

            <!-- VIEW: NARRATIVE -->
            <section id="view-game" class="view hidden pb-24">
                <div id="narrative-content" class="space-y-12 leading-relaxed text-lg text-zinc-300">
                    <!-- Chapters will be injected here -->
                </div>

                <div id="choice-panel" class="hidden mt-12 border border-zinc-800 bg-zinc-950/40 p-6 space-y-4">
                    <div class="typewriter text-xs uppercase tracking-widest text-zinc-500">Decisão do Investigador</div>
                    <div id="choice-text" class="text-zinc-300 text-lg"></div>
                    <div id="choice-buttons" class="grid gap-3"></div>
                </div>

                <!-- LOCK SCREEN -->
                <div id="lock-screen" class="hidden mt-20 pt-20 border-t border-zinc-800 text-center space-y-8 relative">
                    <div class="absolute -top-12 left-1/2 -translate-x-1/2 px-4 bg-[#0a0a0a] text-zinc-500 typewriter text-sm">
                        INTERRUPÇÃO DE SISTEMA
                    </div>
                    <div class="space-y-4">
                        <h3 class="text-3xl text-zinc-100 font-bold">A verdade nunca esteve onde você procurou.</h3>
                        <p class="text-zinc-500 max-w-sm mx-auto">Você acredita que resolveu o caso. Mas o relatório está incompleto. A Parte 2 contém a revelação final.</p>
                    </div>
                    <div class="max-w-xs mx-auto space-y-4">
                        <input type="text" id="unlock-code" placeholder="CÓDIGO DE ACESSO" class="w-full bg-zinc-900 border border-zinc-800 p-4 text-center typewriter tracking-widest focus:outline-none focus:border-red-900 transition-colors uppercase">
                        <button onclick="checkCode(event)" class="w-full bg-zinc-100 text-black py-4 uppercase font-bold text-sm tracking-widest hover:bg-red-800 hover:text-white transition-all">Desbloquear Parte Final</button>
                    </div>
                    
                    <div class="pt-4">
                        <a href="https://wa.me/qr/JTNRPS65GWRZI1" target="_blank" class="inline-flex items-center gap-2 text-zinc-400 hover:text-green-500 transition-colors border border-zinc-800 px-4 py-2 text-xs uppercase tracking-widest typewriter">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg>
                            Solicitar Código de Investigação
                        </a>
                    </div>
                </div>
            </section>

        </main>

        <!-- Footer / Status Bar -->
        <footer class="p-4 border-t border-zinc-900 flex justify-between items-center text-[10px] typewriter text-zinc-600 uppercase">
            <div id="status-left">Sistema Online</div>
            <div id="status-right">Protocolo: Investigador</div>
        </footer>
    </div>

    <script>
        const story = {
            'arquivo-01': {
                title: "O Silêncio do Arquivo 01",
                parts: [
                    {
                        id: 1,
                        chapters: [
                            {
                                title: "Capítulo 1: O Retorno",
                                image: "capitulo-1.jpg",
                                content: "O investigador não abriu o arquivo por curiosidade. Abriu porque alguém o colocou sobre sua mesa. Nenhuma assinatura. Nenhum bilhete. Apenas o mesmo número que ele jurou nunca mais ver: 01-77-B. Pela primeira vez em sete anos, o silêncio do escritório foi quebrado pelo barulho de uma pasta de couro sendo aberta."
                            },
                            {
                                title: "Capítulo 2: O Erro",
                                image: "capitulo-2.jpg",
                                content: "O desaparecimento de Elisa fora tratado como algo simples. Uma rotina quebrada. Uma ausência sem testemunhas. Um relatório encerrado cedo demais. Na época, ele assinou o documento final sem reler a última página. Ele queria que o caso sumisse. Hoje, ele percebeu o que ignorou: o horário do último telefonema não batia com o depoimento do marido."
                            },
                            {
                                title: "Capítulo 3: O Investigador",
                                image: "investigador.jpg",
                                content: "Desde aquele caso, ele se tornara um fantasma nos corredores da delegacia. Rejeitava novos trabalhos, dormia no sofá do escritório e revisava arquivos antigos como quem procura uma saída de um labirinto. Ele sabia que algo estava errado, mas admitir isso era admitir sua própria negligência."
                            },
                            {
                                title: "Capítulo 4: Os Suspeitos",
                                image: "suspeitos.jpg",
                                content: `<div class='space-y-6 bg-zinc-900/30 p-6 border-l-2 border-zinc-700 italic text-sm'>
                                    <div><strong>Suspeito 1: O Marido.</strong> Benefício financeiro imediato. Afirmou estar no trabalho, mas o registro de ponto foi editado manualmente.</div>
                                    <div><strong>Suspeito 2: O Vizinho.</strong> Histórico de obsessão. Testemunhas dizem tê-lo visto limpando o porta-malas às 3h da manhã.</div>
                                    <div><strong>Suspeito 3: O Irmão.</strong> Dívidas de jogo. Foi o último a ver Elisa viva em uma discussão pública.</div>
                                </div>
                                <p class='mt-6'>Todos pareciam culpados. E é exatamente aí que o investigador cometeu seu segundo grande erro. Ele procurou um culpado entre os óbvios, em vez de procurar a verdade.</p>`
                            },
                            {
                                title: "Capítulo 5: As Pistas",
                                image: "capitulo-5.jpg",
                                content: "As datas não batiam. Os depoimentos mudavam de versão conforme o tempo passava. Um documento de perícia técnica aparecia no sistema com duas conclusões diferentes. O investigador, na época, escolheu a explicação mais rápida e lógica: O Marido. Ele foi preso. O caso foi 'resolvido'. O mundo seguiu em frente."
                            },
                            {
                                title: "Capítulo 6: A Conclusão (Falsa)",
                                image: "capitulo-6.jpg",
                                content: "As peças se encaixaram perfeitamente... rápido demais. O marido confessou sob pressão. O caso foi encerrado. Mas ao escrever a última linha agora, sete anos depois, o investigador sentiu o mesmo frio na espinha: não havia alívio. A história fazia sentido, mas não parecia verdadeira. Ele percebeu que a confissão foi comprada. Alguém queria que o marido levasse a culpa para proteger o verdadeiro nome..."
                            }
                        ]
                    },
                    {
                        id: 2,
                        chapters: [
                            {
                                title: "Capítulo 7: O Detalhe Esquecido",
                                image: "capitulo-7.jpg",
                                content: "Revisando as fotos do local, algo brilhou no canto de uma imagem. Não era uma joia de Elisa. Era um distintivo. Um distintivo idêntico ao que o investigador carrega no peito. A prova não foi descartada por falta de relevância, mas por medo."
                            },
                            {
                                title: "Capítulo 8: O Nome Ausente",
                                image: "capitulo-8.jpg",
                                content: "O verdadeiro nome nunca aparecera na lista. Não por falta de provas, mas por influência. O Silêncio fora comprado nos altos escalões. Elisa não desapareceu por causa de um crime passional. Ela desapareceu porque encontrou o arquivo errado na pessoa errada."
                            },
                            {
                                title: "Capítulo 9: A Manipulação",
                                image: "capitulo-9.jpg",
                                content: "O sistema não falhou por acidente. Ele foi treinado para falhar. Cada depoimento editado, cada horário ajustado... tudo levava ao Marido. O investigador foi apenas a ferramenta perfeita: alguém cansado demais para questionar o que parecia óbvio."
                            },
                            {
                                title: "Capítulo 10: O Investigador como Peça",
                                image: "capitulo-10.jpg",
                                content: "Ele não foi enganado pelos suspeitos. Ele foi enganado pelos seus pares. Ele assinou a sentença de um inocente porque era o caminho mais fácil. A verdade estava na sua frente o tempo todo: a caligrafia na ordem de encerramento do caso era do seu próprio mentor."
                            },
                            {
                                title: "Capítulo 11: A Queda",
                                image: "capitulo-11.jpg",
                                content: "O responsável não matou Elisa. Elisa nunca esteve morta. Ela foi enviada para longe, mantida em silêncio sob ameaça contra sua família. O 'crime' foi um teatro montado para remover uma testemunha inconveniente de um esquema de corrupção que o próprio investigador, hoje, sabe que ainda opera."
                            },
                            {
                                title: "Capítulo 12: A Verdade",
                                image: "capitulo-12.jpg",
                                content: "O erro do investigador foi acreditar que a lei e a justiça eram a mesma coisa. O desaparecimento foi a única forma que encontraram de salvá-la de algo pior, mas ao custo de destruir a vida de um homem inocente e a carreira de um investigador que nunca mais dormiria em paz."
                            },
                            {
                                title: "Capítulo 13: O Encerramento",
                                image: "capitulo-13.jpg",
                                content: "O caso foi reaberto em segredo. O Marido foi solto sob uma tecnicalidade jurídica. Ninguém foi preso pela corrupção. Algumas vitórias são silenciosas e amargas. O investigador entregou seu distintivo no mesmo dia em que o arquivo voltou para a prateleira."
                            },
                            {
                                title: "Capítulo 14: Epílogo",
                                image: "capitulo-14.jpg",
                                content: "O arquivo 01-77-B agora tem uma marca definitiva. Não é uma assinatura de juiz ou um selo oficial. É apenas uma palavra escrita à mão, trêmula, em tinta vermelha: RESOLVIDO. O investigador agora sabe: nem toda verdade traz liberdade. Algumas apenas mudam o tamanho da cela."
                            }
                        ]
                    }
                ]
            },
            'arquivo-02': {
                title: "Quem Matou Júlia?",
                parts: [
                    {
                        id: 1,
                        chapters: [
                            {
                                title: "Introdução: O Caso",
                                image: "caso-02-capa.jpg",
                                content: "Júlia não deveria estar morta. Nada indicava perigo, nenhuma ameaça registrada, nenhum histórico violento. O corpo foi encontrado em seu apartamento sem sinais de arrombamento e sem testemunhas diretas. O investigador entrega o arquivo a você: \"Desta vez, não sou eu quem vai errar.\" Agora, a responsabilidade é sua."
                            },
                            {
                                title: "Capítulo 1: A Cena",
                                image: "caso-02-cena.jpg",
                                content: "O apartamento estava limpo demais para uma noite interrompida. A janela aberta deixava entrar um vento frio. O relógio da cozinha marcava 22h17. Júlia estava no chão da sala, sem marcas visíveis. Não havia arma. A porta não estava forçada. Havia, porém, duas xícaras de café sobre a mesa."
                            }
                        ]
                    }
                ]
            }
        };

        const caseNodes = {
            'arquivo-01': {
                start: {
                    text: "Você precisa concluir o relatório. Quem você acusa oficialmente?",
                    choices: [
                        { label: "Acusar o marido", next: "acusacao-marido" },
                        { label: "Acusar o vizinho", next: "acusacao-vizinho" },
                        { label: "Acusar o irmão", next: "acusacao-irmao" }
                    ]
                },
                "acusacao-marido": {
                    text: "A confissão foi escrita rápido demais. Ele estava fragilizado, cercado. Tudo parece encaixar. Mas algo em você não concorda com a própria assinatura.",
                    choices: [
                        { label: "Encerrar o relatório", next: "lock-screen" }
                    ]
                },
                "acusacao-vizinho": {
                    text: "O histórico dele é suspeito. As testemunhas o viram tarde demais. Ainda assim, o relatório exige peças que você não tem. Você sabe disso quando já é tarde.",
                    choices: [
                        { label: "Encerrar o relatório", next: "lock-screen" }
                    ]
                },
                "acusacao-irmao": {
                    text: "As dívidas explicam a motivação. As discussões explicam o medo. Mas o horário não fecha. O caso parece resolvido, porém não verdadeiro.",
                    choices: [
                        { label: "Encerrar o relatório", next: "lock-screen" }
                    ]
                }
            },
            'arquivo-02': {
                start: {
                    text: "O que você faz primeiro?",
                    choices: [
                        { label: "Examinar o corpo", next: "examinar-corpo" },
                        { label: "Examinar o apartamento", next: "examinar-apartamento" }
                    ]
                },
                "examinar-corpo": {
                    text: "Você percebe que não há sinais de luta. As unhas estão intactas. Um detalhe, porém, chama a atenção: uma marca circular no pulso, como se algo tivesse sido amarrado por segundos e removido rápido demais.",
                    choices: [
                        { label: "Interrogar o namorado", next: "interrogar-namorado" },
                        { label: "Investigar o trabalho de Júlia", next: "investigar-trabalho" }
                    ]
                },
                "examinar-apartamento": {
                    text: "O apartamento não foi revirado. A mesa de jantar tem duas xícaras. Uma delas com resíduo de café frio. No lixo, há um bilhete rasgado com palavras incompletas: \"...não posso deixar que ele descub...\".",
                    choices: [
                        { label: "Seguir a pista do bilhete", next: "seguir-bilhete" },
                        { label: "Interrogar a melhor amiga", next: "interrogar-amiga" }
                    ]
                },
                "interrogar-namorado": {
                    text: "O namorado diz que dormia. Mas o celular dele estava ativo às 23h04. Ele fica nervoso quando você menciona o pulso marcado de Júlia. Tudo nele grita culpa. Talvez seja tarde demais para voltar.",
                    choices: [
                        { label: "Acusar o namorado", next: "falso-final" },
                        { label: "Voltar e reexaminar provas", next: "reexaminar" }
                    ]
                },
                "investigar-trabalho": {
                    text: "No trabalho, você descobre que Júlia denunciou um esquema interno. Um colega tentou acessar o prédio naquela noite, mas foi barrado pela portaria. Ele afirma não ter contato pessoal com ela, mas conhece detalhes íntimos da rotina.",
                    choices: [
                        { label: "Interrogar o colega", next: "interrogar-colega" },
                        { label: "Voltar ao apartamento", next: "reexaminar" }
                    ]
                },
                "seguir-bilhete": {
                    text: "A caligrafia é de Júlia. O bilhete fala sobre alguém que ela não podia expor. O pedaço restante diz: \"Se eu falar, ele destrói tudo\". Isso não parece algo sobre o namorado.",
                    choices: [
                        { label: "Investigar o trabalho de Júlia", next: "investigar-trabalho" },
                        { label: "Interrogar a melhor amiga", next: "interrogar-amiga" }
                    ]
                },
                "interrogar-amiga": {
                    text: "A melhor amiga diz que Júlia estava com medo. Ela menciona um detalhe que não foi divulgado: a xícara quebrada na pia. Quando confrontada, ela diz que \"ouviu na rádio\". Mas você sabe que isso não saiu nos registros.",
                    choices: [
                        { label: "Confrontar a amiga", next: "reexaminar" },
                        { label: "Acusar a amiga", next: "falso-final" }
                    ]
                },
                "interrogar-colega": {
                    text: "O colega demonstra medo, não raiva. Ele confessa que tentou entrar no prédio para recuperar um pendrive. Não queria que Júlia entregasse o conteúdo. Ele diz que outra pessoa estava lá naquela noite: alguém que ela confiava.",
                    choices: [
                        { label: "Reexaminar a cena", next: "reexaminar" },
                        { label: "Ignorar e seguir a acusação", next: "falso-final" }
                    ]
                },
                reexaminar: {
                    text: "Você retorna ao apartamento com novos olhos. O detalhe silencioso que você ignorou agora é óbvio: as duas xícaras. Júlia não recebeu o namorado. Ela recebeu alguém que ela confiava — a melhor amiga. Mas quem realmente agiu foi o colega, que usou a amiga para obter acesso e silenciá-la antes que a denúncia fosse entregue.",
                    choices: [
                        { label: "Apontar o verdadeiro culpado", next: "verdadeiro-final" }
                    ]
                },
                "falso-final": {
                    text: "Você fecha o caso. A acusação parece lógica. Mas há um detalhe que nunca se encaixou: a segunda xícara. A história está incompleta. O sistema registra a sua conclusão como falsa.",
                    choices: [
                        { label: "Voltar e revisar", next: "reexaminar" }
                    ]
                },
                "verdadeiro-final": {
                    text: "Você resolveu. O colega de trabalho usou a amizade para acessar Júlia, apagou rastros e tentou plantar uma narrativa simples. A marca no pulso era do cabo do pendrive preso. A denúncia foi recuperada. O caso foi encerrado sem pontas soltas. O arquivo agora traz a palavra: RESOLVIDO.",
                    choices: [
                        { label: "Encerrar e enviar relatório", next: "coming-soon" },
                        { label: "Voltar aos casos", next: "return-cases" }
                    ]
                }
            }
        };

        let currentCaseId = null;
        let isUnlocked = false;
        let activeNodes = null;
        let case02State = { current: "start" };

        // Persistência simples (WebView/PWA-friendly)
        const STORAGE_KEYS = {
            CASE01_DONE: 'arquivoOculto_case01_done',
            CASES_UNLOCKED: 'arquivoOculto_cases_unlocked'
        };

        function getCase01Done() {
            return localStorage.getItem(STORAGE_KEYS.CASE01_DONE) === 'true';
        }

        function setCase01Done(val) {
            localStorage.setItem(STORAGE_KEYS.CASE01_DONE, val ? 'true' : 'false');
            refreshCaseAccessUI();
        }

        function refreshCaseAccessUI() {
            const canAccess02 = getCase01Done();
            const lockedCard = document.getElementById('case-02-locked');
            const unlockedCard = document.getElementById('case-02-unlocked');
            if (!lockedCard || !unlockedCard) return;

            if (canAccess02) {
                lockedCard.classList.add('hidden');
                unlockedCard.classList.remove('hidden');
            } else {
                unlockedCard.classList.add('hidden');
                lockedCard.classList.remove('hidden');
            }
        }

        function requireInvestigationAccessOrStart(caseId) {
            // Regra: Caso 02 só abre se Caso 01 concluído
            if (caseId === 'arquivo-02' && !getCase01Done()) {
                showView('cases');
                return;
            }
            startCase(caseId);
        }

        function showView(viewId) {
            document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
            document.getElementById(`view-${viewId}`).classList.remove('hidden');
            
            if (viewId === 'home') {
                document.getElementById('main-nav').classList.add('hidden');
            } else {
                document.getElementById('main-nav').classList.remove('hidden');
            }
            window.scrollTo(0,0);
        }

        function startCase(id) {
            currentCaseId = id;
            const container = document.getElementById('narrative-content');
            const lockScreen = document.getElementById('lock-screen');
            const choicePanel = document.getElementById('choice-panel');
            container.innerHTML = '';
            
            const caseData = story[id];
            
            if (id === 'arquivo-02') {
                const coverImg = document.createElement('div');
                coverImg.className = 'mb-12 border-b border-zinc-800 pb-12';
                coverImg.innerHTML = `<img src="capa-02.jpg" alt="Capa do Caso" class="w-full h-64 object-cover grayscale opacity-70" onerror="this.style.display='none'">`;
                container.appendChild(coverImg);

                renderPart(caseData.parts[0]);
                lockScreen.classList.add('hidden');
                showChoice('start');
                showView('game');
                return;
            }
            
            // Add Cover Image
            const coverImg = document.createElement('div');
            coverImg.className = 'mb-12 border-b border-zinc-800 pb-12';
            coverImg.innerHTML = `<img src="capa.jpg" alt="Capa do Caso" class="w-full h-64 object-cover grayscale opacity-50" onerror="this.style.display='none'">`;
            container.appendChild(coverImg);

            renderPart(caseData.parts[0]);
            
            choicePanel.classList.add('hidden');
            lockScreen.classList.remove('hidden');
            showView('game');
        }

        function renderPart(part) {
            const container = document.getElementById('narrative-content');
            part.chapters.forEach((ch, index) => {
                const chapterEl = document.createElement('div');
                chapterEl.className = 'chapter-transition opacity-0 mb-20';
                
                let imgHtml = '';
                if (ch.image) {
                    imgHtml = `<div class="mb-6 overflow-hidden border border-zinc-800 rounded-sm">
                        <img src="${ch.image}" alt="${ch.title}" class="w-full grayscale hover:grayscale-0 transition-all duration-700 object-cover max-h-64" onerror="this.style.display='none'">
                    </div>`;
                }

                chapterEl.innerHTML = `
                    ${imgHtml}
                    <h4 class="typewriter text-red-900 text-xs mb-3 uppercase tracking-widest">${ch.title}</h4>
                    <div class="file-border">
                        <div class="text-zinc-300 leading-relaxed space-y-4">${ch.content}</div>
                    </div>
                `;
                container.appendChild(chapterEl);
                
                // Staggered appearance
                setTimeout(() => {
                    chapterEl.classList.remove('opacity-0');
                    chapterEl.classList.add('opacity-100');
                }, index * 400);
            });
        }

        function checkCode(event) {
            const input = document.getElementById('unlock-code');
            const button = event.currentTarget;
            const code = input.value.trim();
            
            // Visual feedback
            button.innerText = "VERIFICANDO...";
            button.disabled = true;

            setTimeout(() => {
                if (code === '25262728') {
                    button.innerText = "ACESSO CONCEDIDO";
                    button.classList.replace('bg-zinc-100', 'bg-green-900');
                    button.classList.replace('text-black', 'text-white');
                    setTimeout(() => {
                        unlockPart2();
                    }, 800);
                } else {
                    button.innerText = "ACESSO NEGADO";
                    button.classList.replace('bg-zinc-100', 'bg-red-900');
                    button.classList.replace('text-black', 'text-white');
                    input.classList.add('border-red-600', 'animate-shake');
                    
                    setTimeout(() => {
                        button.innerText = "Desbloquear Parte Final";
                        button.classList.replace('bg-red-900', 'bg-zinc-100');
                        button.classList.replace('text-white', 'text-black');
                        button.disabled = false;
                        input.classList.remove('border-red-600', 'animate-shake');
                    }, 2000);
                }
            }, 1200);
        }

        function unlockPart2() {
            isUnlocked = true;
            document.getElementById('lock-screen').classList.add('hidden');

            // Marca conclusão/liberação do Caso 01 (para desbloquear o Caso 02)
            if (currentCaseId === 'arquivo-01') {
                setCase01Done(true);
            }
            
            const caseData = story[currentCaseId];
            renderPart(caseData.parts[1]);
            
            // Notification
            const statusRight = document.getElementById('status-right');
            statusRight.innerText = "Acesso Nível 2: Liberado";
            statusRight.classList.add('text-red-700');
        }

        function showChoice(nodeId) {
            // nós interativos do Caso 02
            const graph = caseNodes['arquivo-02'];
            const node = graph ? graph[nodeId] : null;
            const panel = document.getElementById('choice-panel');
            const textEl = document.getElementById('choice-text');
            const buttonsEl = document.getElementById('choice-buttons');

            if (!node) return;

            case02State.current = nodeId;
            panel.classList.remove('hidden');
            textEl.textContent = node.text;
            buttonsEl.innerHTML = '';

            node.choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = 'w-full text-left border border-zinc-800 bg-zinc-950/60 px-4 py-3 text-sm uppercase tracking-widest text-zinc-300 hover:border-red-900 hover:text-white transition-colors';
                btn.textContent = choice.label;
                btn.addEventListener('click', () => {
                    if (choice.next === 'return-cases') {
                        showView('cases');
                        return;
                    }
                    if (choice.next === 'coming-soon') {
                        showComingSoon();
                        return;
                    }
                    showChoice(choice.next);
                });
                buttonsEl.appendChild(btn);
            });
        }

        function showComingSoon() {
            const container = document.getElementById('narrative-content');
            const panel = document.getElementById('choice-panel');
            panel.classList.add('hidden');

            container.insertAdjacentHTML('beforeend', `
                <div class="mt-16 border border-zinc-800 bg-zinc-950/40 p-6 space-y-4">
                    <div class="typewriter text-xs uppercase tracking-widest text-zinc-500">COMUNICADO DO SISTEMA</div>
                    <h3 class="text-2xl text-zinc-100">Mais investigações em breve.</h3>
                    <p class="text-zinc-400">Você concluiu esta investigação. Nosso sistema recebe novos arquivos regularmente.</p>
                    <p class="text-zinc-500 text-sm">Aguarde: atualizamos nossos casos todos os meses. Quando um novo arquivo estiver disponível, ele aparecerá na lista de casos.</p>
                    <div class="pt-2 flex gap-3 flex-wrap">
                        <button onclick="showView('cases')" class="border border-zinc-800 px-4 py-2 text-xs uppercase tracking-widest typewriter text-zinc-300 hover:border-red-900 hover:text-white transition-colors">Voltar aos Casos</button>
                        <button onclick="showView('home')" class="border border-zinc-800 px-4 py-2 text-xs uppercase tracking-widest typewriter text-zinc-400 hover:text-white transition-colors">Tela Inicial</button>
                    </div>
                </div>
            `);

            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }

        // Initialize
        refreshCaseAccessUI();
        showView('home');
    </script>
</body>
</html>